<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta itemprop=name content="Infrastructure as Code"><meta itemprop=description content="Infrastructure as code is the practice of managing and provisioning resources through definition files"><meta itemprop=datePublished content="2021-04-25T00:02:25+02:00"><meta itemprop=dateModified content="2021-04-25T00:02:25+02:00"><meta itemprop=wordCount content="715"><meta itemprop=keywords content="devops,infrastructure,"><meta property="og:title" content="Infrastructure as Code"><meta property="og:description" content="Infrastructure as code is the practice of managing and provisioning resources through definition files"><meta property="og:type" content="article"><meta property="og:url" content="https://baris.io/posts/infrastructure-as-code/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-04-25T00:02:25+02:00"><meta property="article:modified_time" content="2021-04-25T00:02:25+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Infrastructure as Code"><meta name=twitter:description content="Infrastructure as code is the practice of managing and provisioning resources through definition files"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Infrastructure as Code</title><link rel=stylesheet href=https://baris.io/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://baris.io/>baris.io</a></div><nav class="site-nav hide-in-mobile"><a href=https://baris.io/posts/>Posts</a>
<a href=https://baris.io/tags/>Tags</a>
<a href=https://baris.io/about/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/bariskalkar target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://linkedin.com/in/mbaris target=_blank rel="noopener me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://github.com/mbaris target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://baris.io/posts/>Posts</a></li><li><a href=https://baris.io/tags/>Tags</a></li><li><a href=https://baris.io/about/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Apr 25, 2021</span></div><h1>Infrastructure as Code</h1></header><div class=content><p><em>Infrastructure as Code</em> is the practice of managing and provisioning resources through version controlled definition files.</p><p>Things to note beforehand</p><ul><li>Cloud providers like AWS, Azure and GCP allow us to provision new resources in mere minutes or even seconds.</li><li>Multiple deployments to production every day is not an exceptional thing anymore</li><li>We want to use a similar infrastructure for multiple environments(dev,staging,prod etc.) and regions</li><li>Infrastructure on cloud does not only mean hosting applications on a virtual machine
It also includes services we can use like data stores, queues/topics, network components, access rights/permission models and much more</li><li>Utilizing these resources efficiently will help us move forward much faster</li></ul><h2 id=what-problem-does-it-solve>What problem does it solve?<a href=#what-problem-does-it-solve class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>While cloud computing provides us an easy and fast way to get access to new resources, we still have to create, keep an inventory of and decommission them when necessary.
In a traditional on-premise setup, we would document and apply all the steps manually when we need to install and run services on these servers.
However, this approach does not scale well if we want to get the full benefits of using cloud providers.
Because development and maintenance of an application on cloud can easily require hundreds of resources across different accounts.
So we definitely need some kind of proper automation.</p><h2 id=how-does-it-work>How does it work?<a href=#how-does-it-work class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ul><li>Create configuration files or scripts defining required resources, and their relations with each other.
These can be written in bash or domain specific languages like <a href=https://www.terraform.io>Terraform/HCL</a> or <a href=https://aws.amazon.com/cloudformation/resources/templates/>Cloudformation Templates</a></li><li>Store them in a version control system like git. This can be done in two ways and both has their advantages/disadvantages.<ul><li>Along with the service using these resources</li><li>In a centralized repository which contains all resources used by the company</li></ul></li><li>Integrate these tools/scripts to our CI/CD pipeline</li><li>Applying the same configuration should always give the same result regardless of the state of the infrastructure when we started.
This is a broader concept called <a href=https://en.wikipedia.org/wiki/Idempotence>Idempotency</a> and it is a really important in IaC</li></ul><h3 id=imperative-vs-declarative>Imperative vs Declarative<a href=#imperative-vs-declarative class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>It is important to note that Infrastructure as Code can be implemented with both approaches effectively.</p><p>Using an imperative approach to create an AWS Lambda function would look like below</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>aws lambda create-function <span class=se>\
</span><span class=se></span>    --function-name my-function <span class=se>\
</span><span class=se></span>    --runtime nodejs12.x <span class=se>\
</span><span class=se></span>    --zip-file fileb://my-function.zip <span class=se>\
</span><span class=se></span>    --handler exports.test <span class=se>\
</span><span class=se></span>    --role arn:aws:iam::123456789012:role/service-role/iam_for_lambda
</code></pre></div><p>While with a declarative approach, it would look like this.</p><div class=highlight><pre class=chroma><code class=language-HCL data-lang=HCL><span class=k>resource</span> <span class=s2>&#34;aws_lambda_function&#34; &#34;my-function&#34;</span> {
<span class=n>  filename</span>      <span class=o>=</span> <span class=s2>&#34;lambda_function_payload.zip&#34;</span>
<span class=n>  function_name</span> <span class=o>=</span> <span class=s2>&#34;lambda_function_name&#34;</span>
<span class=n>  role</span>          <span class=o>=</span> <span class=k>aws_iam_role</span><span class=p>.</span><span class=k>iam_for_lambda</span><span class=p>.</span><span class=k>arn</span>
<span class=n>  handler</span>       <span class=o>=</span> <span class=s2>&#34;exports.test&#34;</span>
<span class=n>  source_code_hash</span> <span class=o>=</span> <span class=k>filebase64sha256</span><span class=p>(</span><span class=s2>&#34;my-function.zip&#34;</span><span class=p>)</span>
<span class=n>  runtime</span> <span class=o>=</span> <span class=s2>&#34;nodejs12.x&#34;</span>
}
</code></pre></div><h2 id=why-should-we-use-it>Why should we use it?<a href=#why-should-we-use-it class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><h3 id=consistency>Consistency<a href=#consistency class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>Even if we are really careful, any manual process involving humans is error prone.
Getting the same result every time you need a new environment prevents so many problems like having different configurations
for test and prod environments or wasting time on errors due to misconfigurations</p><h3 id=speed>Speed<a href=#speed class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>If we properly integrate infrastructure as code to our build pipelines, our resource provisioning can be completely automated.
Not spending time on creating resources means more time efficient development and deployment processes.</p><h3 id=accountability>Accountability<a href=#accountability class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>We already have best practices regarding source control. With peer reviews and pull requests, any change in the infrastructure is visible and obvious
We can track down what changed with which deployment and also revert to a previous version easily if we need to.</p><h3 id=scalability>Scalability<a href=#scalability class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>We might need to deploy our services to completely new regions to expand or new environments for reasons like development, tests or demos.
With infrastructure as code, we are not bound to number of people who can create infrastructure and manage them for our team.</p><h2 id=conclusion>Conclusion<a href=#conclusion class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>My first experience with IaC was an in-house tool made by engineers in the company, and it saved so much time and effort when we were developing Opsgenie.
I can&rsquo;t imagine how difficult and stressful deployments would be if we were manually creating database tables, iam policies and queues every other day.</p><p>More recently, I have been using Terraform at work and what you can build with it is impressive. Especially since there are so many modules available to use.
I will take a look at <a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs/guides/custom-service-endpoints#localstack>creating infrastructure with</a> <a href=https://github.com/localstack/localstack>localstack</a> on a personal project soon</p><p>There is obviously a learning curve for everyone involved, but it is certainly worth the effort.<br>In my opinion, this is one thing every software company should spend some time on.</p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://baris.io/tags/devops>devops</a></span><span class=tag><a href=https://baris.io/tags/infrastructure>infrastructure</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>715 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2021-04-24 22:02 +0000</p></footer></article><div class="post-nav thin"><a class=next-post href=https://baris.io/posts/python-typing/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>Python Type Hints</span></a>
<a class=prev-post href=https://baris.io/posts/observability/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Observability 101</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2021 <a href=https://baris.io/>Mehmet Barış Kalkar</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://baris.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://baris.io/js/bundle.min.7d8545daa55d62427355498dd8da13f98ff79a7938ce7d2a5e2ae1ec0de3beb8.js integrity="sha256-fYVF2qVdYkJzVUmN2NoT+Y/3mnk4zn0qXirh7A3jvrg=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-56410734-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>