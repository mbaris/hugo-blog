<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta itemprop=name content="Design Patterns - Singleton"><meta itemprop=description content="Singleton is a design pattern that limits the instantiation of a class to a single instance and provides global access to it"><meta itemprop=datePublished content="2021-04-19T23:49:53+02:00"><meta itemprop=dateModified content="2021-04-19T23:49:53+02:00"><meta itemprop=wordCount content="538"><meta itemprop=keywords content="programming,java,design-patterns,"><meta property="og:title" content="Design Patterns - Singleton"><meta property="og:description" content="Singleton is a design pattern that limits the instantiation of a class to a single instance and provides global access to it"><meta property="og:type" content="article"><meta property="og:url" content="https://baris.io/posts/singleton/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-04-19T23:49:53+02:00"><meta property="article:modified_time" content="2021-04-19T23:49:53+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Design Patterns - Singleton"><meta name=twitter:description content="Singleton is a design pattern that limits the instantiation of a class to a single instance and provides global access to it"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Design Patterns - Singleton</title><link rel=stylesheet href=https://baris.io/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://baris.io/>baris.io</a></div><nav class="site-nav hide-in-mobile"><a href=https://baris.io/posts/>Posts</a>
<a href=https://baris.io/tags/>Tags</a>
<a href=https://baris.io/about/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/bariskalkar target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://linkedin.com/in/mbaris target=_blank rel="noopener me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://github.com/mbaris target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://baris.io/posts/>Posts</a></li><li><a href=https://baris.io/tags/>Tags</a></li><li><a href=https://baris.io/about/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Apr 19, 2021</span></div><h1>Design Patterns - Singleton</h1></header><div class=content><p>Singleton is a design pattern that limits the instantiation of a class to a single instance and provides global access to it.</p><p>If we want to have only a single instance of a class, and it must be accessible from a well-defined access point we can use singletons. In recent years singletons are seen as <a href=https://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons>bad practice</a> but they are still one of the most well-known design patterns. They are used in logging, caching, hardware interfaces, and configuration/properties files. Singletons are pretty easy(deceptively) to implement.</p><p>For a basic implementation, we need:</p><ul><li>a private constructor to restrict new instance creation</li><li>a static member of singleton type</li><li>a static public getInstance method to give access to this instance</li></ul><h2 id=basic-implementation>Basic Implementation<a href=#basic-implementation class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MySingleton</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=n>MySingleton</span> <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MySingleton</span><span class=o>();</span>

    <span class=kd>private</span> <span class=nf>MySingleton</span><span class=o>(){}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=n>MySingleton</span> <span class=nf>getInstance</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>instance</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>doStuff</span><span class=o>()</span> <span class=o>{</span>
        <span class=c1>//some work here
</span><span class=c1></span>    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>Although this is usable, we generally want to lazily initialize our singleton instance because if we have a lot of singleton classes and if all of them are eagerly loaded, the startup of our application will be affected.</p><h2 id=lazy-loading>Lazy Loading<a href=#lazy-loading class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>So we can naively change it to something like this.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MySingleton</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=n>MySingleton</span> <span class=n>instance</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>

    <span class=kd>private</span> <span class=nf>MySingleton</span><span class=o>(){}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=n>MySingleton</span> <span class=nf>getInstance</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>if</span><span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MySingleton</span><span class=o>();</span>
        <span class=o>}</span>
        <span class=k>return</span> <span class=n>instance</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>doStuff</span><span class=o>()</span> <span class=o>{</span>
        <span class=c1>//some work here
</span><span class=c1></span>    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>This is a little bit better but we have new problems now because this implementation is not threadsafe. Also, other people can use reflection to bypass our restriction on the constructor.</p><h2 id=thread-safety>Thread-Safety<a href=#thread-safety class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>We should make the instance variable <em>volatile</em> to give it visibility across threads and make the instantiation synchronized.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MySingleton</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>volatile</span> <span class=n>MySingleton</span> <span class=n>instance</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>

    <span class=kd>private</span> <span class=nf>MySingleton</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>if</span><span class=o>(</span><span class=n>instance</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=o>(</span><span class=s>&#34;Already instantiated&#34;</span><span class=o>);</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=n>MySingleton</span> <span class=nf>getInstance</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>if</span><span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=kd>synchronized</span><span class=o>(</span><span class=n>MySingleton</span><span class=o>.</span><span class=na>class</span><span class=o>)</span> <span class=o>{</span>
                <span class=k>if</span><span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=o>){</span>
                    <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MySingleton</span><span class=o>();</span>
                <span class=o>}</span>
            <span class=o>}</span>
        <span class=o>}</span>
        <span class=k>return</span> <span class=n>instance</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>doStuff</span><span class=o>()</span> <span class=o>{</span>
        <span class=c1>//some work here
</span><span class=c1></span>    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>We compare the instance with null twice, the first one is to not block reads to the instance if it is already initialized. If we made the getInstance method synchronized, it would also work but with much worse performance.</p><h2 id=enum-singletons>Enum Singletons<a href=#enum-singletons class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Even though it looks like a weird trick, using <a href=https://stackoverflow.com/a/71399>enums</a> is widely accepted as one of the best ways to implement singletons. We solve the problems with thread-safety, reflection, and lazy loading. I did not write about them here but using Enums solve problems with cloning and serialization as well.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>enum</span> <span class=n>MySingleton</span> <span class=o>{</span>
    <span class=n>INSTANCE</span><span class=o>;</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>doStuff</span><span class=o>()</span> <span class=o>{</span>
        <span class=c1>//some work here
</span><span class=c1></span>    <span class=o>}</span>
<span class=o>}</span>

</code></pre></div><p>We should consider these before using singletons:</p><ul><li>They violate the <a href=https://en.wikipedia.org/wiki/Single_responsibility_principle>SRP</a> since they control their lifecycle and behavior</li><li>They cause the code to be <a href=https://stackoverflow.com/q/2832017>tightly coupled</a></li><li>They make testing <a href=https://stackoverflow.com/a/2085988>harder</a></li><li>If we are not careful they are not thread-safe</li></ul><p>Spring beans have singleton scope by default, but they are not exactly the same concept. Java Singletons are scoped by the Java class loader, Spring singletons on the other hand can be any class we have written but spring will only create one instance for that class in that container context.</p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://baris.io/tags/programming>programming</a></span><span class=tag><a href=https://baris.io/tags/java>java</a></span><span class=tag><a href=https://baris.io/tags/design-patterns>design-patterns</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>538 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2021-04-19 21:49 +0000</p></footer></article><div class="post-nav thin"><a class=next-post href=https://baris.io/posts/observability/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>Observability 101</span></a>
<a class=prev-post href=https://baris.io/posts/builder/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Design Patterns - Builder</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2021 <a href=https://baris.io/>Mehmet Barış Kalkar</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://baris.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://baris.io/js/bundle.min.7d8545daa55d62427355498dd8da13f98ff79a7938ce7d2a5e2ae1ec0de3beb8.js integrity="sha256-fYVF2qVdYkJzVUmN2NoT+Y/3mnk4zn0qXirh7A3jvrg=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-56410734-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>